{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Jekyll v3.8.5">
    <title>AutoCusto</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/4.3/examples/starter-template/">

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <!-- Custom styles for this template -->
    
    <link rel="stylesheet" type="text/css" href="{% static 'css/base.css' %}?v=1.1">
    <link rel="stylesheet" type="text/css" href="{% static 'css/home.css' %}">
    <link href="{% static '/iconic/font/css/open-iconic-bootstrap.css' %}" rel="stylesheet">

  </head>
  <body>
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
  <a class="navbar-brand" href="{% url 'home' %}">
    <img src="{% static 'img/logo.png' %}" alt="AutoCusto Logo" style="height: 52px; vertical-align: middle; margin-right: 8px;">
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarsExampleDefault">

    <ul class="navbar-nav mr-auto">
      {% if user.is_authenticated %}
      <li class="nav-item">
          <!-- Quick patient search for authenticated users -->
        <form action="{% url 'processos-renovacao-rapida' %}" method="GET" class="form-inline my-2 my-lg-0" novalidate>
          <input name="b" class="form-control mr-sm-2" type="text" placeholder="Paciente por nome ou CPF" aria-label="Search">
          <button class="btn btn-outline-light" type="submit"><span class="oi oi-magnifying-glass"></span>Buscar</button>
        </form>
      </li>
      {% endif %}

      {% if user.is_staff %}
      <li class="nav-item">
        <a class="nav-link" href="/admin">Admin</a>
      </li>
      {% endif %}

    </ul>

    <ul class="navbar-nav ml-auto">
      {% if user.is_authenticated %}

            <li class="nav-item">
        <a class="nav-link" href="{% url 'clinicas-cadastro' %}">Cl√≠nicas</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="{% url 'reportar-erros' %}">Reportar Erros</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="{% url 'solicitar-funcionalidade' %}">Solicitar Funcionalidade</a>
      </li>
      <li class="nav-item">
        <form method="post" action="{% url 'logout' %}" style="display: inline; margin: 0; padding: 0;" novalidate>
          {% csrf_token %}
          <button type="submit" class="nav-link btn btn-link">
            Logout <span class="oi oi-account-logout"></span>
          </button>
        </form>
      </li>
      {% endif %}
    </ul>
    
    {% if user.is_authenticated %}

    {% else %}
    <!-- Compact login form for non-authenticated users -->
    <div class="toast-enabled">
      <form method="POST" action="{% url 'login' %}" class="form-inline my-2 my-lg-0" novalidate>
      {% csrf_token %}
      <input name="username" type="email" class="form-control mr-sm-2" placeholder="Email" aria-label="Email" style="max-width: 150px;">
      <input name="password" type="password" class="form-control mr-sm-2" placeholder="Senha" aria-label="Password" style="max-width: 120px;">
      <button class="btn btn-outline-light" type="submit">
        <span class="oi oi-account-login"></span> Login
      </button>
      </form>
    </div>
    {% endif %}
  </div>
</nav>

  <!-- Alpine.js Toast Container -->
  <style>
    .inline-toast-wrapper {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 9999;
      max-width: 420px;
    }
    .inline-toast-wrapper .toast {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 12px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15), 0 4px 12px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      overflow: hidden;
      max-width: 420px;
      min-width: 350px;
      margin-bottom: 1rem;
      animation: slideInUp 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      transition: all 0.3s ease;
    }
    @keyframes slideInUp {
      0% {
        transform: translateY(100%) translateX(50%) scale(0.9);
        opacity: 0;
      }
      100% {
        transform: translateY(0) translateX(0) scale(1);
        opacity: 1;
      }
    }
    .inline-toast-wrapper .toast-header {
      border-bottom: none;
      padding: 1.25rem 1.5rem 1rem;
      font-weight: 700;
      border-radius: 12px 12px 0 0;
      font-size: 1rem;
      margin: 0;
      color: white;
      display: flex;
      align-items: center;
    }
    .inline-toast-wrapper .toast.bg-danger .toast-header {
      background: linear-gradient(135deg, #fa709a, #ff6b9d);
      color: white;
    }
    .inline-toast-wrapper .toast.bg-success .toast-header {
      background: linear-gradient(135deg, #4facfe, #00d4ff);
      color: white;
    }
    .inline-toast-wrapper .toast.bg-warning .toast-header {
      background: linear-gradient(135deg, #43e97b, #38f9d7);
      color: #2d3748;
    }
    .inline-toast-wrapper .toast.bg-info .toast-header {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }
    .inline-toast-wrapper .toast-body {
      background: rgba(255, 255, 255, 0.98);
      color: #2d3748;
      padding: 1.25rem 1.5rem;
      line-height: 1.6;
      backdrop-filter: blur(10px);
      font-size: 0.95rem;
      font-weight: 500;
      margin: 0;
      border-radius: 0 0 12px 12px;
    }
    .inline-toast-wrapper .close {
      color: rgba(255, 255, 255, 0.9);
      opacity: 0.8;
      font-size: 1.4rem;
      font-weight: 700;
      transition: all 0.3s ease;
      padding: 0.5rem;
      margin: -0.5rem -0.75rem -0.5rem auto;
      border: none;
      background: none;
      text-shadow: none;
      line-height: 1;
      cursor: pointer;
    }
  </style>
  <div x-data="toastContainer()" x-init="init(); checkForFormErrors()" class="inline-toast-wrapper" x-cloak>
    <!-- DEBUG: Toast container initialized -->
    <script>console.log('[DEBUG] Toast container initialized');</script>
    <template x-for="toast in toasts" :key="toast.id">
      <div :class="getToastClasses(toast)" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
          <i :class="getIconClass(toast)" class="mr-2"></i>
          <strong class="mr-auto" x-text="getTitle(toast)"></strong>
          <button type="button" class="ml-2 mb-1 close" @click="removeToast(toast.id); console.log('[DEBUG] Toast closed', toast);" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="toast-body" x-html="toast.message.replace(/\n/g, '<br>')"></div>
        <script>console.log('[DEBUG] Toast rendered:', toast);</script>
      </div>
    </template>
  </div>

  <!-- Pass Django messages to Alpine.js toast system -->
  {% if messages %}
  <!-- DEBUG: Django messages detected in base.html -->
  <script>
    window.djangoMessages = [
      {% for message in messages %}
        {
          message: "{{ message|escapejs }}",
          type: "{{ message.tags }}"
        }{% if not forloop.last %},{% endif %}
      {% endfor %}
    ];
    console.log('[DEBUG] window.djangoMessages:', window.djangoMessages);
  </script>
  <script>console.log('[DEBUG] Django messages block executed in base.html');</script>
  {% else %}
  <script>console.log('[DEBUG] No Django messages found in base.html');</script>
  {% endif %}

    {%block content %}{% endblock %}

    <!-- Scripts -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="{% static 'js/toast-system.js' %}"></script>
    
    <!-- Alpine.js - Must load AFTER toast-system.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  
    {% block scripts %}
    {% endblock %}

    </body>
</html>