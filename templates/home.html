{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load static %}

{% block content %}


{% if user.is_authenticated %}
<div class="container d-flex justify-content-center" style="height: 10vh;">
        <div class="card bg-light mb-3 my-auto" style="max-width: 55vw;">
            <div class="card-header">Adicionar processo</div>
            <div class="card-body">
                    <form method="POST" autocomplete="off" id="js-form" data-busca-doencas="{% url 'busca-doencas' %}" data-busca-pacientes="{% url 'busca-pacientes'%}">
                        {% csrf_token %}
                        <div class="form-row ">
                            <div class="col-sm-6"> CPF paciente<br>{{ formulario.cpf_paciente|as_crispy_field }} </div>
                            <div class="col-sm-3"> Doença<br>{{ formulario.cid|as_crispy_field }} </div>
                            <div class="col-sm-3"><br><button class="btn btn-dark" type="submit">Cadastrar</button></div>
                    </form>
            </div>
            <div>
                <ul class="list-group resultados" id="resultados"></ul>
                <ul class="list-group resultados" id="pacientes"></ul>
            </div>
        </div>     
</div>
    
    {% else %}
    <!-- Hero Section with Registration Form -->
    <div class="container my-5">
        <div class="row">
            <!-- Left Column: Hero Content -->
            <div class="col-lg-6">
                <div class="py-5">
                    <h1 class="display-4 text-primary-color mb-4">LME em 2 cliques!</h1>
                    <p class="lead text-secondary mb-4">Agilidade e precisão para médicos e clínicas na emissão de receitas de medicamentos especiais.</p>
                    
                    <div class="mb-4 p-3 bg-light rounded">
                        <p class="mb-2"><strong>Sobre o desenvolvedor:</strong></p>
                        <p class="mb-2 text-muted text-justify">Olá, me chamo Lucas. Sou neurologista formado pela UNIFESP e estudo Informática da Saúde na <a href="https://www.th-deg.de">Technische Hochschule Deggendorf</a>. Gosto de ir direto ao ponto: minha missão é fazer você focar nos seus pacientes, sem perder tempo com burocracia.</p>
                        <p class="mb-3 text-muted text-justify">Sempre amei tecnologia — especialmente software livre. Por isso, desenvolvi este sistema de forma aberta, com código licenciado por Creative Commons e auditável. É uma ferramenta feita por quem vive o dia a dia da saúde e sabe onde a tecnologia pode realmente ajudar.</p>
                        <div class="d-flex flex-wrap align-items-center justify-content-between">
                            <a href="https://github.com/lcsavb/autocusto" target="_blank" class="btn btn-outline-dark btn-sm mb-2 mb-md-0">
                                <span class="oi oi-code mr-2"></span>
                                Ver código no GitHub
                            </a>
                            <div class="text-muted small">
                                <a href="{% url 'privacy-policy' %}" class="text-muted mr-3">
                                    <span class="oi oi-shield mr-1"></span>
                                    Privacidade
                                </a>
                                <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" class="text-muted">
                                    <img src="https://licensebuttons.net/l/by-nc-sa/4.0/80x15.png" alt="CC License" style="height: 15px;">
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Features Carousel -->
                    <div class="d-flex align-items-center" style="min-height: 200px;">
                        <div id="featuresCarousel" class="carousel slide w-100" data-ride="carousel" data-interval="3000">
                            <div class="carousel-inner">
                                <div class="carousel-item active">
                                    <div class="d-flex align-items-center w-100 py-5 px-4 bg-light rounded shadow-sm">
                                        <span class="oi oi-clock text-primary-color mr-4" style="font-size: 4rem;"></span>
                                        <div class="flex-grow-1">
                                            <h3 class="mb-3 text-primary-color">Rapidez</h3>
                                            <p class="mb-0 text-muted lead">Prescrições em minutos, não horas</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="carousel-item">
                                    <div class="d-flex align-items-center w-100 py-5 px-4 bg-light rounded shadow-sm">
                                        <span class="oi oi-shield text-primary-color mr-4" style="font-size: 4rem;"></span>
                                        <div class="flex-grow-1">
                                            <h3 class="mb-3 text-primary-color">Precisão</h3>
                                            <p class="mb-0 text-muted lead">Validação automática e conformidade</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="carousel-item">
                                    <div class="d-flex align-items-center w-100 py-5 px-4 bg-light rounded shadow-sm">
                                        <span class="oi oi-graph text-primary-color mr-4" style="font-size: 4rem;"></span>
                                        <div class="flex-grow-1">
                                            <h3 class="mb-3 text-primary-color">Gestão</h3>
                                            <p class="mb-0 text-muted lead">Histórico e controle simplificados</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Carousel indicators -->
                            <ol class="carousel-indicators" style="bottom: -40px;">
                                <li data-target="#featuresCarousel" data-slide-to="0" class="active bg-primary"></li>
                                <li data-target="#featuresCarousel" data-slide-to="1" class="bg-primary"></li>
                                <li data-target="#featuresCarousel" data-slide-to="2" class="bg-primary"></li>
                            </ol>
                        </div>
                    </div>
                    
                </div>
            </div>
            
            <!-- Right Column: Registration Form -->
            <div class="col-lg-6">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary-color text-white">
                        <h3 class="card-title mb-0">
                            <span class="oi oi-task mr-2"></span>
                            Cadastro Médico
                        </h3>
                    </div>
                    <div class="card-body p-4">
                        <p class="text-muted mb-4">Preencha os dados abaixo para criar sua conta e prescreva agora mesmo.</p>
                        
                        <!-- Registration form using Crispy Forms -->
                        {% if registro_form %}
                        <form method="POST" action="{% url 'medicos-cadastro' %}">
                            {% csrf_token %}
                            {{ registro_form|crispy }}
                            <button type="submit" class="btn btn-primary btn-lg btn-block mt-3">
                                <span class="oi oi-task mr-2"></span>
                                Criar Conta e Começar
                            </button>
                        </form>
                        {% else %}
                        <!-- Fallback simple registration form -->
                        <p class="text-center">
                            <a href="{% url 'medicos-cadastro' %}" class="btn btn-primary btn-lg">
                                <span class="oi oi-task mr-2"></span>
                                Ir para Cadastro Completo
                            </a>
                        </p>
                        {% endif %}
                        
                                   </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

{% endblock content %}

{% block scripts %}
{% if user.is_authenticated %}
<script src="{% static 'processos/js/buscaDoencas.js' %}"></script>
<script src="{% static 'processos/js/buscaPacientes.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js" integrity="sha256-Kg2zTcFO9LXOc7IwcBx1YeUBJmekycsnTsq2RuFHSZU=" crossorigin="anonymous"></script>
<script src="{% static 'processos/js/mascaras.js' %}"></script>
{% endif %}
{% endblock %}